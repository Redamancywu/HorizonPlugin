# Android SDK Gradle 插件开发需求文档

## 1. 项目概述

### 1.1 项目背景
开发一个通用的 Gradle 插件，用于简化和标准化 Android SDK 的开发流程。该插件适用于小型、中型和中大型 SDK 项目，提供核心功能支持，优化开发体验。

### 1.2 适用范围
- **小型 SDK**：单一功能模块（如埋点、权限封装等）
- **中型 SDK**：多功能模块（如推送、认证、分析等）
- **中大型 SDK**：模块化架构、多 flavor 支持、丰富的构建配置

### 1.3 项目目标
1. 提供轻量级但功能完整的 Gradle 插件
2. 简化 SDK 开发流程
3. 标准化构建配置
4. 优化开发体验

## 2. 功能需求

### 2.1 核心功能矩阵

#### 2.1.1 模块自动注册
| 功能 | 说明 | 优先级 | 技术实现 |
|------|------|--------|----------|
| 注解扫描 | 自动扫描模块注解 | P1 | KSP + KotlinPoet |
| 初始化类生成 | 自动生成模块初始化代码 | P1 | KSP 代码生成 |

#### 2.1.2 构建变体支持
| 功能 | 说明 | 优先级 | 技术实现 |
|------|------|--------|----------|
| Flavor 管理 | 支持多环境构建 | P0 | AGP productFlavors |
| BuildConfig 注入 | 环境配置注入 | P0 | 自动生成配置类 |

#### 2.1.3 代码保护
| 功能 | 说明 | 优先级 | 技术实现 |
|------|------|--------|----------|
| 混淆规则注入 | 自动注入基础混淆规则 | P0 | proguard-rules.sdk.pro |
| 自定义规则支持 | 支持开发者追加规则 | P1 | API 接口支持 |

#### 2.1.4 组件管理
| 功能 | 说明 | 优先级 | 技术实现 |
|------|------|--------|----------|
| Manifest 合并 | 自动处理清单文件合并 | P0 | Manifest Merger |
| 组件行为控制 | 提供组件配置能力 | P1 | tools:node 属性 |

#### 2.1.5 资源管理
| 功能 | 说明 | 优先级 | 技术实现 |
|------|------|--------|----------|
| 命名空间管理 | 自动设置资源命名空间 | P0 | namespace 配置 |
| 资源冲突处理 | 预防资源命名冲突 | P1 | 资源前缀检查 |

### 2.2 扩展功能

#### 2.2.1 日志系统
- 日志等级控制
- 环境区分处理
- 性能优化（Release 自动关闭）

#### 2.2.2 异常处理
- Crash 监控机制
- 自定义异常处理器
- 异常上报接口

#### 2.2.3 安全机制
- 请求签名支持
- 加密算法模板
- 密钥管理机制

# ✅ 一、适合中小型 SDK 的 Gradle 插件功能矩阵（推荐版本）

| 编号 | 功能模块 | 子功能 | 是否默认启用 | 是否可配置 | 技术实现方式 | 适用场景 |
|------|----------|--------|----------------|--------------|------------------|-----------|
| 1 | 模块自动注册 | 注解扫描 | ❌ | ✅ | KSP + KotlinPoet | 中型 SDK 多模块管理 |
| 2 | 模块自动注册 | 自动生成初始化类 | ❌ | ✅ | KSP 扫描并生成代码 | 自动注册模块 |
| 3 | 构建变体支持 | Flavor 管理 | ✅ | ✅ | AGP productFlavors | dev/staging/prod 支持 |
| 4 | 构建变体支持 | BuildConfig 注入 | ✅ | ✅ | 自动生成 API_HOST、ENABLE_LOG | 控制不同环境行为 |
| 5 | ProGuard 混淆规则 | 自动注入规则 | ✅ | ✅ | 插件注入 `proguard-rules.sdk.pro` | 防止关键类混淆 |
| 6 | ProGuard 混淆规则 | 开发者追加规则 | ✅ | ✅ | 提供接口添加额外 keep 规则 | 更灵活控制 |
| 7 | Manifest 合并 | 自动合并 | ✅ | ✅ | 使用 `<merge>` 标签 | 多模块 Manifest 合并 |
| 8 | Manifest 合并 | 组件行为控制 | ✅ | ✅ | tools:node="merge" / replace | 控制组件行为 |
| 9 | 资源命名空间 | 自动设置 namespace | ✅ | ❌ | 设置 `namespace 'com.example.sdk'` | 官方推荐资源隔离方式 |
| 10 | 日志系统封装 | 日志等级控制 | ❌ | ✅ | `.setLogLevel(LogLevel.VERBOSE)` | 控制输出级别 |
| 11 | 日志系统封装 | 默认关闭日志 | ✅ | ✅ | Release 下默认不输出 | 提高性能 |
| 12 | Crash 监控 | 异常捕获 | ❌ | ✅ | Thread.setDefaultUncaughtExceptionHandler | 自动捕获异常 |
| 13 | 请求签名与加密 | 签名算法模板 | ❌ | ✅ | HMAC-SHA256、MD5 | 安全加固 |
| 14 | 请求签名与加密 | 密钥注入 | ✅ | ✅ | 提供 API 设置签名密钥 | 保证安全性 |
| 15 | 插件发布与版本管理 | MavenLocal 发布 | ✅ | ✅ | 本地调试使用 | 本地安装 |
| 16 | 插件发布与版本管理 | MavenCentral/JitPack 支持 | ✅ | ✅ | 官方推荐发布渠道 | 适合开源项目 |
| 17 | 插件 DSL 配置 | Kotlin DSL 支持 | ✅ | ✅ | build.gradle.kts | 类型安全 |
| 18 | 插件 DSL 配置 | Groovy DSL 支持 | ✅ | ✅ | build.gradle | 兼容旧项目 |
| 19 | 插件文档与接入指南 | README 文档 | ✅ | ✅ | 包含安装、配置、示例 | 初学者友好 |
| 20 | 插件文档与接入指南 | 示例工程 | ✅ | ✅ | 示例 SDK 使用插件的效果 | 快速上手 |



# 📦 插件发布建议

| 发布方式 | 是否推荐 | 说明 |
|----------|-----------|------|
| MavenLocal | ✅ 推荐 | 本地调试使用 |
| MavenCentral | ✅ 推荐 | 官方推荐发布渠道 |
| JitPack | ✅ 推荐 | 快速发布 |
| 私有仓库（Artifactory/Nexus） | ✅ 推荐 | 企业级 SDK 推荐 |


---


# 📌 总结：适合中小型 SDK 的插件功能清单

| 功能模块 | 功能描述 | 是否必须 |
|----------|----------|----------|
| 模块自动注册 | 编译期自动生成模块注册逻辑 | ✅ 推荐 |
| 构建变体支持 | 支持多 flavor 和 BuildConfig | ✅ 必须 |
| ProGuard 混淆规则 | 自动注入防止关键类被混淆 | ✅ 必须 |
| Manifest 合并与组件控制 | 自动合并 Manifest 文件 | ✅ 必须 |
| 资源命名空间隔离 | 避免资源冲突 | ✅ 必须 |
| 日志系统封装 | 控制日志等级 | ✅ 推荐 |
| Crash 监控机制 | 自动捕获异常 | ✅ 推荐 |
| 请求签名与加密 | 提供标准签名方法 | ✅ 推荐 |
| 插件发布与版本管理 | 支持发布到 MavenCentral / JitPack | ✅ 必须 |
| 插件 DSL 支持 | 支持 KTS 和 Groovy | ✅ 必须 |
| 插件文档与接入指南 | 提供 README 和示例工程 | ✅ 必须 |

